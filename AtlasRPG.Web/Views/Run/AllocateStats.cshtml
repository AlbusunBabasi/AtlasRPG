@model AtlasRPG.Web.Models.RunViews.AllocateStatsViewModel
@{
    ViewData["Title"] = "Allocate Stats";
}

<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">💎 Allocate Stat Points</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-info">
                <strong>Available Points: <span id="remainingPoints">@Model.AvailablePoints</span></strong>
            </div>

            <form asp-action="AllocateStats" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="RunId" />
                <div asp-validation-summary="All" class="text-danger mb-3"></div>

                <div class="row">
                    <!-- Strength -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>💪 Strength</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentStrength</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="StrengthToAdd">-</button>
                                <input type="number" asp-for="StrengthToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="StrengthToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases physical damage and melee damage</small>
                        </div>
                    </div>

                    <!-- Dexterity -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>🎯 Dexterity</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentDexterity</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="DexterityToAdd">-</button>
                                <input type="number" asp-for="DexterityToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="DexterityToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases ranged damage and accuracy</small>
                        </div>
                    </div>

                    <!-- Agility -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>⚡ Agility</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentAgility</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="AgilityToAdd">-</button>
                                <input type="number" asp-for="AgilityToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="AgilityToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases initiative and evasion</small>
                        </div>
                    </div>

                    <!-- Intelligence -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>🧠 Intelligence</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentIntelligence</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="IntelligenceToAdd">-</button>
                                <input type="number" asp-for="IntelligenceToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="IntelligenceToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases spell damage and max mana</small>
                        </div>
                    </div>

                    <!-- Vitality -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>❤️ Vitality</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentVitality</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="VitalityToAdd">-</button>
                                <input type="number" asp-for="VitalityToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="VitalityToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases max HP and armor</small>
                        </div>
                    </div>

                    <!-- Wisdom -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>📘 Wisdom</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentWisdom</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="WisdomToAdd">-</button>
                                <input type="number" asp-for="WisdomToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="WisdomToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases max mana and ward</small>
                        </div>
                    </div>

                    <!-- Luck -->
                    <div class="col-md-6 mb-3">
                        <div class="stat-row p-3 border rounded">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>🍀 Luck</strong>
                                <span class="badge bg-secondary">Current: @Model.CurrentLuck</span>
                            </div>
                            <div class="input-group">
                                <button type="button" class="btn btn-sm btn-outline-danger stat-btn" data-action="decrease" data-stat="LuckToAdd">-</button>
                                <input type="number" asp-for="LuckToAdd" class="form-control text-center stat-input" min="0" max="@Model.AvailablePoints" readonly />
                                <button type="button" class="btn btn-sm btn-outline-success stat-btn" data-action="increase" data-stat="LuckToAdd">+</button>
                            </div>
                            <small class="text-muted">Increases crit damage and loot quality</small>
                        </div>
                    </div>
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg me-2">
                        ✅ Confirm Allocation
                    </button>
                    <a asp-action="TurnHub" asp-route-id="@Model.RunId" class="btn btn-outline-secondary btn-lg">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const maxPoints = @Model.AvailablePoints;
        let remainingPoints = maxPoints;

        function updateRemainingPoints() {
            const inputs = document.querySelectorAll('.stat-input');
            let total = 0;
            inputs.forEach(input => {
                total += parseInt(input.value) || 0;
            });
            remainingPoints = maxPoints - total;
            document.getElementById('remainingPoints').textContent = remainingPoints;
        }

        document.querySelectorAll('.stat-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const action = this.dataset.action;
                const statName = this.dataset.stat;
                const input = document.querySelector(`input[name="${statName}"]`);
                let currentValue = parseInt(input.value) || 0;

                if (action === 'increase' && remainingPoints > 0) {
                    input.value = currentValue + 1;
                } else if (action === 'decrease' && currentValue > 0) {
                    input.value = currentValue - 1;
                }

                updateRemainingPoints();
            });
        });

        updateRemainingPoints();
    </script>
}